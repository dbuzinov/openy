<div class="facebook_login_account_creation_component" id="component_$component_id">

	[[ if close_popup ]]
	<script type="text/javascript">

		var data = {};
		var component_id = '$component_id_esc_js';
		var callback = 'facebook_login_popup_callback_' + component_id;
		data.error_message = '$error_message_esc_js';
		data.error_description = '$error_description_esc_js';
		data.error_code = '$error_code_esc_js';
		data.error_reason = '$error_reason_esc_js';

		window.opener[callback]( data );
		setTimeout(function( ) { window.close(); }, 1000);

	</script>
	[[ end if close_popup ]]
 
	[[ if show_facebook_login_button ]]
	<a class="facebook_login_button"
	   id="facebook_login_button_$component_id"
	   href="$facebook_login_url"
	>
		Log in with your Facebook Account
	</a>

	[[ if is_popup ]]
	<script>
	CWjQuery( function() {

		var component_id = '$component_id_esc_js';
		
		var callback_function_name = 'facebook_login_popup_callback_' + component_id;

		function open_facebook_popup (options) {
			options.windowName = options.windowName || 'ConnectWithOAuth';
			options.windowOptions = options.windowOptions || 'location=0,status=0,width='+options.width+',height='+options.height+',scrollbars=1';

			window.open(options.path, options.windowName, options.windowOptions);
		}

		CWjQuery('#component_' + component_id).on(
			'click',
			'#facebook_login_button_' + component_id,
			function(event) {
				event.preventDefault();
				open_facebook_popup({
					path: event.target.href,
					width:600,
					height:300
				});
			}
		);

		var callback = function(data) {

			var popup_close_url = '$popup_close_url_esc_js';

			data.error_message = typeof data.error_message !== 'undefined' ? data.error_message : null;
			data.error_description = typeof data.error_description !== 'undefined' ? data.error_description : null;
			data.error_code = typeof data.error_code !== 'undefined' ? data.error_code : null;
			data.error_reason = typeof data.error_reason !== 'undefined' ? data.error_reason : null;

			url = addParameter(popup_close_url, 'error_message', data.error_message);
			url = addParameter(url, 'error_description', data.error_description);
			url = addParameter(url, 'error_code', data.error_code);
			url = addParameter(url, 'error_reason', data.error_reason);
			window.location.href = url;
		};

		window[callback_function_name] = callback
	});
	</script>
	[[ end if is_popup ]]

	[[ end if show_facebook_login_button ]]

</div>
