services:
  config.ymca_google.settings:
    class: \Drupal\Core\Config\ImmutableConfig
    factory: config.factory:get
    arguments: ['ymca_google.settings']
  logger.channel.ymca_google:
    parent: logger.channel_base
    arguments: ['gcal_groupex']
  ymca_google.ics_fetcher:
    class: Drupal\ymca_google\IcsFetcher
    arguments: ['@ymca_google.groupex_wrapper', '@logger.channel.ymca_google', '@http_client', '@ymca_mappings.location_repository']
  ymca_google.pusher:
    class: Drupal\ymca_google\GooglePush
    arguments: ['@ymca_google.groupex_wrapper', '@config.factory', '@logger.channel.ymca_google', '@entity_type.manager', '@ymca_google.drupal_proxy', '@entity.query']
  ymca_google.groupex_wrapper:
    class: Drupal\ymca_google\GcalGroupexWrapper
    arguments: ['@state', '@logger.factory', '@config.ymca_google.settings']
  ymca_google.data_fetcher:
    class: Drupal\ymca_google\GroupexDataFetcher
    arguments: ['@ymca_google.groupex_wrapper']
    properties:
      debug: false
  ymca_google.drupal_proxy:
    class: Drupal\ymca_google\DrupalProxy
    arguments: ['@ymca_google.groupex_wrapper', '@entity.query', '@logger.channel.ymca_google', '@ymca_google.data_fetcher', '@plugin.manager.gcal_updater', '@entity_type.manager']
  ymca_google.syncer:
    class: Drupal\ymca_sync\Syncer
    arguments: ['@ymca_google.groupex_wrapper']
    calls:
      - [addStep, ['@ymca_google.ics_fetcher', 'fetch']]
      - [addStep, ['@ymca_google.data_fetcher', 'fetch']]
      - [addStep, ['@ymca_google.drupal_proxy', 'saveEntities']]
      - [addStep, ['@ymca_google.pusher', 'proceed']]
    tags:
      - { name: syncer }
  plugin.manager.gcal_updater:
    class: Drupal\ymca_google\GCalUpdaterManager
    arguments: ['@container.namespaces', '@cache.default', '@module_handler']
  ymca_google.test_manager:
    class: Drupal\ymca_google\YmcaGoogleTestManager
    arguments: ['@config.factory']
